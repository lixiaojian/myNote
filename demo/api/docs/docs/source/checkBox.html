<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * @ignore
 * Created by xiaojianli on 2015/7/9.
 * 多选框控件
 */

;(function(){

    var doc = document;
    var addDomEvent = UTIL.addDomEvent;
    var fixedEvent = UTIL.fixedEvent;
    var addClass = UTIL.dom.addClass;
    var removeClass = UTIL.dom.removeClass;
    var filterElemByClass = UTIL.dom.filterElemByClass;
    var ensureAfterDomRenderer = UTIL.ensureAfterDomRenderer;

<span id='PDIKit-form-CheckBox-cfg-parentElement'><span id='PDIKit-form-CheckBox'>    /**
</span></span>     * &lt;h2&gt;多选框组件&lt;/h2&gt;
     * 对外暴露为：PDIKit.form.CheckBox&lt;br&gt;
     *    &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;初始化示例:
     *    &lt;pre&gt;
     *    var radio = new PDIKit.form.CheckBox({
     *          parentElement:document.getElementById(&#39;radioBox&#39;)
     *     });
     *    &lt;/pre&gt;
     *
     * @class PDIKit.form.CheckBox
     * @cfg {String} parentElement
     * 需要初始化组件的父节点
     *
     */
    var CheckBox = function(opt){
        this.parentElement = opt.parentElement || null;
        //所有的checkbox
        this.checkBoxes = [];
        this.checkedAll=null;
        //默认选中的checkbox的值
        this.checkedVals=[];
        this.init();
    };
    //在一个标签后面插入一个标签
    function insertAfter(newElement, targetElement){
        var parent = targetElement.parentNode;
        if (parent.lastChild == targetElement){
            parent.appendChild(newElement);
        } else {
            parent.insertBefore(newElement,targetElement.nextSibling);
        }
    }
<span id='PDIKit-form-CheckBox-method-initComps'>    /**
</span>     * @method
     *  内部调用的方法  用于初始化插件的骨架
     * @private
     * @param {Function}cb  回调方法
     */
    var initComps = function(cb){
        var p = this.parentElement || doc;
        //获取所有的多选框
        var checkBoxes = filterElemByClass(p,&#39;input&#39;,&#39;checkbox-input&#39;);

        for(var m=0;m&lt;checkBoxes.length;m++){
            var input = checkBoxes[m];
            //标记checkBox父级
            addClass(input.parentElement,&#39;chechbox-parent&#39;);
            addClass(input,&#39;hidden&#39;);
            //默认选中的
            if(input.checked){
                this.checkedVals.push(input.value);
            };
            var label = doc.createElement(&#39;a&#39;);
            label.href=&#39;javascript:void(0);&#39;;
            //全选
            if(input.className.indexOf(&#39;cg-sub-act-all-input&#39;)===-1){
                label.className=&#39;cg-sub-act&#39;;
                insertAfter(label,input);
                this.checkBoxes.push(input);
            }else{
                label.className=&#39;cg-sub-act-all&#39;;
                insertAfter(label,input);
                this.checkedAll = label;
            }
        };
    };
    //为一个checkbox设置值
    function setValue(value,input){
        var label = input.nextSibling;
        input.checked = value;
        if(value){
            addClass(label,&#39;checked&#39;);
            var labels = filterElemByClass(this.parentElement,&#39;a&#39;,&#39;checked&#39;);
            if(labels.length === this.checkBoxes.length){
                this.checkedAll.previousSibling.checked = true;
                addClass(this.checkedAll,&#39;checked&#39;);
            }
        }else{
            this.checkedAll.previousSibling.checked = false;
            removeClass(label,&#39;checked&#39;);
            removeClass(this.checkedAll,&#39;checked&#39;);
        }

    };
<span id='PDIKit-form-CheckBox-method-initEvent'>    /**
</span>     * @method
     *  内部调用的方法  用于初始化事件
     * @private
     */
    var initEvent = function(){
        var che = this;
        var p = this.parentElement;
        if(!p) return;
        var boxParents = filterElemByClass(p,&#39;span&#39;,&#39;chechbox-parent&#39;);
        //添加点击事件
        for(var index in boxParents){
            addDomEvent(boxParents[index],&#39;click&#39;,function(e){
                var label = this.getElementsByTagName(&#39;a&#39;)[0];
                var input = label.previousSibling;
                var checked = input.checked;
                //点击全选
                if(label.className.indexOf(&#39;cg-sub-act-all&#39;)&gt;-1){
                    if(input.checked){
                        input.checked = false;
                        removeClass(label,&#39;checked&#39;);
                        for(var i=0;i&lt;che.checkBoxes.length;i++){
                            che.checkBoxes[i].checked = false;
                            removeClass(che.checkBoxes[i].nextSibling,&#39;checked&#39;);
                        }
                    }else{
                        input.checked = true;
                        addClass(label,&#39;checked&#39;);
                        for(var i=0;i&lt;che.checkBoxes.length;i++){
                            che.checkBoxes[i].checked = true;
                            addClass(che.checkBoxes[i].nextSibling,&#39;checked&#39;);
                        }
                    }
                }else{
                    if(checked){
                        setValue.call(che,false,input);
                    }else{
                        setValue.call(che,true,input);
                    }
                };
                che.checkedVals = che.getValues();
            })
        };
    };
    //添加初始化方法
    CheckBox.prototype = {
        init: function(cb){
            initComps.call(this);
            initEvent.call(this);
            //设置默认选中
            ensureAfterDomRenderer(function(){
                this.setValues(this.checkedVals);
            }, this, 10);
        },

<span id='PDIKit-form-CheckBox-method-getValues'>        /**
</span>         * 得到一个数组值
         * @method
         * @returns {Array}
         */
        getValues : function(){
            var values = [];
            for(var i=0;i&lt;this.checkBoxes.length;i++){
                if(this.checkBoxes[i].checked){
                    values.push(this.checkBoxes[i].value);
                }
            }
            return values;
        },

<span id='PDIKit-form-CheckBox-method-getStrValues'>        /**
</span>         * 得到一个字符串的值
         * @method
         * @returns {string}
         */
        getStrValues: function(){
            return this.getValues().join(&#39;,&#39;);
        },
<span id='PDIKit-form-CheckBox-method-clearVal'>        /**
</span>         * 清除值
         * @method
         */
        clearVal:function(){
            for(var i=0;i&lt;this.checkBoxes.length;i++){
                setValue.call(this,false,this.checkBoxes[i]);
            }
        },
<span id='PDIKit-form-CheckBox-method-setValues'>        /**
</span>         * 设置值
         * @method
         * @param  values
         */
        setValues:function(values){
            var vals = [];
            if(&#39;string&#39; === typeof(values)){
                vals = values.split(&#39;,&#39;);
            }else if(&#39;number&#39; === typeof(values)){
                vals.push(values);
            }else if(values instanceof Array){
                vals = values;
            }
            for(var i=0;i&lt;this.checkBoxes.length;i++){
                setValue.call(this,false,this.checkBoxes[i]);
                for(var j=0;j&lt;vals.length;j++){
                    if(this.checkBoxes[i].value == vals[j]){
                        setValue.call(this,true,this.checkBoxes[i]);
                    }
                }
            }
        },
<span id='PDIKit-form-CheckBox-method-reload'>        /**
</span>         * 组件刷新
         * @method
         */
        reload:function(){
            var checkBoxes = this.checkBoxes;
            this.checkedVals = [];
            for(var i=0;i&lt;checkBoxes.length;i++){
                if(checkBoxes[i].checked){
                    this.checkedVals.push(checkBoxes[i].value);
                }
            };
            this.setValues(this.checkedVals);
        }
    };
    window.PDIKit = window.PDIKit || {};
    window.PDIKit.form = window.PDIKit.form ||{};
    window.PDIKit.form.CheckBox = window.PDIKit.form.CheckBox || CheckBox;
}());</pre>
</body>
</html>
